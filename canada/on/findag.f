      SUBROUTINE FINDAG(I,ISPC,D1,D2,H,SITAGE,SITHT,AGMAX,HTMAX1,HTMAX2,
     &                  DEBUG)
      IMPLICIT NONE
C----------
C CANADA-ON $Id$
C----------
C  THIS ROUTINE FINDS EFFECTIVE TREE AGE
C  CALLED FROM **COMCUP
C  CALLED FROM **CRATET
C----------
C  COMMONS
C
C
      INCLUDE 'PRGPRM.F77'
      INCLUDE 'CONTRL.F77'
      INCLUDE 'ARRAYS.F77'
      INCLUDE 'PLOT.F77'
C
C  COMMONS
C----------
C  DECLARATIONS
C----------
      LOGICAL DEBUG
      INTEGER I,ISPC,MODE0,IVAR
      REAL D1,D2,SITAGE,SITHT,AGMAX,HTMAX1,HTMAX2
      REAL HTG1,H,YRS,HTMAX,AGET
      REAL D3,P2
C
C     SILENCE GFORTRAN WARNING
      AGMAX = AGMAX
      D1 = D1
      D2 = D2
      HTMAX1 = HTMAX1
      HTMAX2 = HTMAX2
      SITHT = SITHT
      
      HTG1=0.      
      D3=DBH(I)
      P2=PCT(I)
C----------
C   CALL HTCALC TO CALCULATE AGE BASED ON INITIAL TREE HEIGHT
C----------
      MODE0= 0
      IVAR=1
      YRS=10.
      AGET=0.
      HTMAX=0.
      IF(DEBUG) WRITE(JOSTND,*) 'IN FINDAG CALLING HTCALC 1: MODE0,',
     &  'IVAR,ISPC,SITEAR(ISPC),BA,YRS,H,AGET,HTMAX,HTG1,JOSTND,',
     &  'DEBUG,D3,P2',
     &   MODE0,IVAR,ISPC,SITEAR(ISPC),BA,YRS,H,AGET,HTMAX,
     &   HTG1,JOSTND,DEBUG,D3,P2      
C      
      CALL HTCALC (MODE0,IVAR,ISPC,SITEAR(ISPC),BA,YRS,H,AGET,HTMAX,
     &             HTG1,JOSTND,DEBUG,D3,P2)
      IF(DEBUG) WRITE(JOSTND,*) 'IN FINDAG BACK FROM HTCALC 1: MODE0,',
     &  'IVAR,ISPC,SITEAR(ISPC),BA,YRS,H,AGET,HTMAX,HTG1,JOSTND,',
     &  'DEBUG,D3,P2',
     &   MODE0,IVAR,ISPC,SITEAR(ISPC),BA,YRS,H,AGET,HTMAX,
     &   HTG1,JOSTND,DEBUG,D3,P2      
C----------
C  IF H >= HTMAX THEN CALCULATE AGE BASED ON HTMAX - 1. FT.
C  THE FORMULA FOR AGE IS UNSTABLE FOR HEIGHTS >= HTMAX.
C----------
      IF(DEBUG)WRITE(JOSTND,*)'In FINDAG 2',HTMAX,H,AGET,HTG1,D3,P2
      IF (HTMAX-H.LE.1.) THEN
        H = HTMAX - 1.1
      IF(DEBUG) WRITE(JOSTND,*) 'IN FINDAG CALLING HTCALC 2: MODE0,',
     &  'IVAR,ISPC,SITEAR(ISPC),BA,YRS,H,AGET,HTMAX,HTG1,JOSTND,',
     &  'DEBUG,D3,P2',
     &   MODE0,IVAR,ISPC,SITEAR(ISPC),BA,YRS,H,AGET,HTMAX,
     &   HTG1,JOSTND,DEBUG,D3,P2      
        CALL HTCALC (MODE0,IVAR,ISPC,SITEAR(ISPC),BA,YRS,H,AGET,HTMAX,
     &               HTG1,JOSTND,DEBUG,D3,P2)
      ENDIF

      IF(DEBUG)WRITE(JOSTND,*)'In FINDAG 3',HTMAX,H,AGET,HTG1,D3,P2
      SITAGE = AGET

      IF(DEBUG)WRITE(JOSTND,50)
   50 FORMAT(' LEAVING SUBROUTINE FINDAG')
C
      RETURN
      END
C**END OF CODE SEGMENT